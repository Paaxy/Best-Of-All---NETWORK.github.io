<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dino — Single File Game</title>
<style>
  :root{--bg:#f7f7f7;--ground:#efefef;--accent:#2b2b2b}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--accent)}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(#e9f3ff, #f7f7f7)}
  .card{width:100%;max-width:900px;padding:18px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  h1{font-size:18px;margin:0}
  .meta{display:flex;gap:10px;align-items:center}
  .btn{background:#1976d2;color:#fff;border:0;padding:8px 12px;border-radius:6px;cursor:pointer}
  .game-box{background:var(--ground);border-radius:8px;padding:14px;box-shadow:0 6px 18px rgba(20,20,40,0.08)}
  canvas{display:block;width:100%;height:auto;background:linear-gradient(#86c5ff,#cfe9ff);border-radius:6px}
  .overlay{position:relative;margin-top:8px;display:flex;justify-content:space-between;align-items:center}
  .controls{display:flex;gap:8px}
  .touch-button{padding:10px 14px;background:#1e88e5;color:#fff;border-radius:8px;border:0;font-weight:700;cursor:pointer}
  .info{font-size:14px;color:#333}
  .center{display:flex;gap:8px;align-items:center}
  .msg{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.6);color:#fff;padding:12px 18px;border-radius:8px;display:none;z-index:5}
  .msg.show{display:block}
  @media (max-width:520px){ header{flex-direction:column;align-items:flex-start;gap:10px} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Single-file Dino — Tap / Space to jump</h1>
        <div class="meta">
          <div class="info">Score: <strong id="score">0</strong></div>
          <button id="restart" class="btn">Restart</button>
        </div>
      </header>

      <div class="game-box" style="position:relative">
        <canvas id="game" width="900" height="200" aria-label="Dino runner game"></canvas>
        <div id="msg" class="msg" role="status"></div>
      </div>

      <div class="overlay" style="margin-top:10px">
        <div class="center small">Controls: Space / Arrow Up / Tap to jump — Arrow Down to duck</div>
        <div class="controls">
          <button id="jumpBtn" class="touch-button">Jump</button>
          <button id="duckBtn" class="touch-button">Duck</button>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const restartBtn = document.getElementById('restart');
  const jumpBtn = document.getElementById('jumpBtn');
  const duckBtn = document.getElementById('duckBtn');
  const msg = document.getElementById('msg');

  const W = 900, H = 200;
  canvas.width = W; canvas.height = H;

  function svgDataURL(svg){ return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg); }

  const dinoSVG = `<svg xmlns='http://www.w3.org/2000/svg' width='64' height='48' viewBox='0 0 64 48'>
    <defs><pattern id='tex' width='6' height='6' patternUnits='userSpaceOnUse'>
      <rect width='6' height='6' fill='#1976d2'/><path d='M0 6 L6 0' stroke='#1e88e5' stroke-width='1' /></pattern></defs>
    <rect x='2' y='6' width='44' height='28' rx='6' fill='url(#tex)' stroke='#0b47a1' stroke-width='2'/>
    <rect x='42' y='16' width='18' height='10' rx='4' fill='#1976d2' stroke='#0b47a1' stroke-width='2'/>
  </svg>`;

  const cactusSVG = `<svg xmlns='http://www.w3.org/2000/svg' width='44' height='64' viewBox='0 0 44 64'>
    <defs><pattern id='cpat' width='8' height='8' patternUnits='userSpaceOnUse'>
      <rect width='8' height='8' fill='#2e7d32'/><path d='M0 8 L8 0' stroke='#43a047' stroke-width='1'/></pattern></defs>
    <rect x='12' y='8' width='20' height='44' rx='6' fill='url(#cpat)' stroke='#1b5e20' stroke-width='2'/>
  </svg>`;

  const cloudSVG = `<svg xmlns='http://www.w3.org/2000/svg' width='120' height='60' viewBox='0 0 120 60'>
    <defs><linearGradient id='cg' x1='0' x2='1'><stop offset='0' stop-color='#fff' /><stop offset='1' stop-color='#e6f0ff'/></linearGradient></defs>
    <ellipse cx='40' cy='34' rx='34' ry='18' fill='url(#cg)' opacity='0.95'/><ellipse cx='70' cy='30' rx='30' ry='16' fill='url(#cg)' opacity='0.95'/>
  </svg>`;

  const dinoImg = new Image(), cactusImg = new Image(), cloudImg = new Image();
  dinoImg.src = svgDataURL(dinoSVG); cactusImg.src = svgDataURL(cactusSVG); cloudImg.src = svgDataURL(cloudSVG);

  const groundY = H - 40;
  const player = { x:70, w:44, h:34, y: groundY - 34, vy:0, jumping:false, ducking:false, color:'#1976d2' };

  let obstacles = [], clouds = [], lastSpawn = 0, lastCloud = 0;
  let spawnInterval = 1400, speed = 280, score = 0, running = true, lastTime = performance.now();

  function reset(){
    obstacles = []; clouds = []; lastSpawn = lastCloud = 0; spawnInterval = 1400; speed = 280; score = 0;
    running = true; player.y = groundY - player.h; player.vy = 0; player.jumping = false; player.ducking = false;
    msg.classList.remove('show'); updateScore();
  }

  function updateScore(){ scoreEl.textContent = Math.floor(score); }

  function spawnObstacle(){
    const types = [{w:24,h:36},{w:36,h:50},{w:18,h:28}];
    const t = types[Math.floor(Math.random()*types.length)];
    obstacles.push({ x: W + 20, y: groundY - t.h, w: t.w, h: t.h, img: cactusImg });
  }

  function spawnCloud(){
    clouds.push({ x: W + 40, y: 20 + Math.random()*50, speed: 40 + Math.random()*40, img: cloudImg });
  }

  function applyPhysics(dt){
    const GRAVITY = 1200;
    // always apply gravity when not firmly on ground
    if (player.y < groundY - player.h || player.vy !== 0) {
      player.vy += GRAVITY * dt;
      player.y += player.vy * dt;
      if (player.y >= groundY - player.h) {
        player.y = groundY - player.h;
        player.vy = 0;
        player.jumping = false;
      }
    }
  }

  function step(dt){
    if (!running) return;
    applyPhysics(dt);

    for (let i = obstacles.length - 1; i >= 0; i--) {
      obstacles[i].x -= speed * dt;
      if (obstacles[i].x + obstacles[i].w < -40) obstacles.splice(i,1);
    }
    for (let i = clouds.length - 1; i >= 0; i--) {
      clouds[i].x -= clouds[i].speed * dt;
      if (clouds[i].x < -200) clouds.splice(i,1);
    }

    lastSpawn += dt * 1000;
    if (lastSpawn > spawnInterval){ lastSpawn = 0; spawnObstacle(); spawnInterval = 900 + Math.random()*1100; speed += 6; }
    lastCloud += dt * 1000;
    if (lastCloud > 1200 + Math.random()*3500){ lastCloud = 0; spawnCloud(); }

    for (let o of obstacles){
      if (rectsIntersect({x:player.x, y:player.y, w:player.w, h:player.h}, {x:o.x, y:o.y, w:o.w, h:o.h})) {
        running = false;
        showMessage('Game Over', 'Tap Restart or press R');
      }
    }

    score += dt * (speed * 0.02);
    updateScore();
  }

  function rectsIntersect(a,b){ return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h); }

  function draw(){
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = '#e8e8e8'; ctx.fillRect(0, groundY, W, H - groundY);
    ctx.fillStyle = 'rgba(0,0,0,0.03)';
    for (let i = 0; i < W; i += 12) ctx.fillRect(i, groundY + Math.sin(i/30 + score/80)*2 + 20, 6, 1);

    for (let c of clouds) { if (c.img.complete) ctx.drawImage(c.img, Math.round(c.x), Math.round(c.y), 120, 60); }
    for (let o of obstacles) {
      if (o.img.complete) ctx.drawImage(o.img, Math.round(o.x), Math.round(o.y), o.w, o.h);
      else { ctx.fillStyle = '#2e7d32'; ctx.fillRect(o.x, o.y, o.w, o.h); }
    }

    const drawW = player.w, drawH = player.h;
    if (dinoImg.complete) ctx.drawImage(dinoImg, Math.round(player.x), Math.round(player.y), drawW, drawH);
    else { ctx.fillStyle = player.color; ctx.fillRect(player.x, player.y, drawW, drawH); }

    ctx.fillStyle = '#333'; ctx.font = '14px system-ui, Arial'; ctx.fillText('Score: ' + Math.floor(score), W - 150, 28);
  }

  function loop(ts){
    const dt = Math.min(40, ts - lastTime) / 1000; lastTime = ts;
    step(dt); draw(); requestAnimationFrame(loop);
  }

  function showMessage(title, subtitle){
    msg.innerHTML = `<strong style="display:block">${title}</strong><span style="font-size:12px">${subtitle}</span>`;
    msg.classList.add('show');
  }

  function isGrounded(){ return player.y >= groundY - player.h - 0.5; }

  function jump(){
    if (!running) return;
    if (!player.jumping && isGrounded()){
      player.jumping = true;
      player.vy = -520;
    }
  }

  function duckStart(){
    if (player.jumping) return;
    if (!player.ducking){
      player.ducking = true;
      player.h = 20;
      player.y = groundY - player.h;
    }
  }

  function duckEnd(){
    if (player.ducking){
      player.ducking = false;
      player.h = 34;
      player.y = groundY - player.h;
    }
  }

  window.addEventListener('keydown', (e) => {
    if ([' ', 'Spacebar'].includes(e.key)) { e.preventDefault(); jump(); }
    if (['ArrowUp','w','W'].includes(e.key)) { e.preventDefault(); jump(); }
    if (['ArrowDown','s','S'].includes(e.key)) { e.preventDefault(); duckStart(); }
    if (e.key === 'r' || e.key === 'R') restart();
  });

  window.addEventListener('keyup', (e) => {
    if (['ArrowDown','s','S'].includes(e.key)) duckEnd();
  });

  canvas.addEventListener('pointerdown', (e) => {
    const rect = canvas.getBoundingClientRect(); const x = e.clientX - rect.left;
    if (x > rect.width * 0.75) duckStart(); else jump();
    canvas.setPointerCapture?.(e.pointerId);
  });
  canvas.addEventListener('pointerup', (e) => { duckEnd(); try{ canvas.releasePointerCapture(e.pointerId); }catch(_){} });
  canvas.addEventListener('pointercancel', () => duckEnd());

  jumpBtn.addEventListener('click', jump);
  duckBtn.addEventListener('pointerdown', duckStart);
  duckBtn.addEventListener('pointerup', duckEnd);
  duckBtn.addEventListener('pointercancel', duckEnd);

  function restart(){ reset(); lastTime = performance.now(); msg.classList.remove('show'); }

  restartBtn.addEventListener('click', restart);

  reset(); lastTime = performance.now(); requestAnimationFrame(loop);

  window.addEventListener('resize', ()=>{ /* canvas scales via CSS - nothing needed */ });

})();
</script>
</body>
</html>